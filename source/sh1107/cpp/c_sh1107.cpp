#include "sh1107/c_sh1107.h"

#include "rdno_core/c_malloc.h"
#include "rdno_core/c_gpio.h"
#include "rdno_core/c_timer.h"
#include "rdno_core/c_serial.h"
#include "rdno_core/c_packet.h"
#include "rdno_core/c_str.h"
#include "rdno_core/c_system.h"
#include "rdno_core/c_wire.h"

#include "rdno_wifi/c_tcp.h"
#include "rdno_wifi/c_node.h"

#include "common/c_common.h"

#include "rdno_u8g2/U8x8lib.h"
#include "rdno_u8g2/U8g2lib.h"

namespace ncore
{
    struct state_app_t
    {
    };
    state_app_t gAppState;

}  // namespace ncore

static const unsigned char image_humidityIcon_bits[] = {0x20, 0x00, 0x20, 0x00, 0x30, 0x00, 0x70, 0x00, 0x78, 0x00, 0xf8, 0x00, 0xfc, 0x01, 0xfc, 0x01, 0x7e, 0x03, 0xfe, 0x02, 0xff, 0x06, 0xff, 0x07, 0xfe, 0x03, 0xfe, 0x03, 0xfc, 0x01, 0xf0, 0x00};
static const unsigned char image_Layer_26_bits[]     = {0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff};
static const unsigned char image_Layer_27_1_bits[]   = {0x01, 0x01, 0x04, 0x04, 0x01, 0x00, 0x04, 0x04, 0x01, 0x00, 0x04, 0x04, 0x81, 0xe1, 0x3d, 0x0e, 0x01, 0x11, 0x45, 0x04,
                                                        0x01, 0x11, 0x45, 0x04, 0x01, 0x11, 0x45, 0x04, 0x9f, 0xe3, 0x45, 0x18, 0x00, 0x00, 0x01, 0x00, 0x00, 0xe0, 0x00, 0x00};
static const unsigned char image_Layer_27_2_bits[]   = {0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
                                                        0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
                                                        0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
                                                        0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01};
static const unsigned char image_Layer_27_3_bits[]   = {0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f};
static const unsigned char image_Layer_27_4_bits[]   = {0xe7, 0x2c, 0x29, 0x55, 0xe7, 0x54, 0x21, 0x54, 0x21, 0x00};
static const unsigned char image_Layer_27_5_bits[]   = {0x03, 0x00, 0x02, 0x00, 0x92, 0x12, 0x92, 0x0c, 0x92, 0x0c, 0xe7, 0x12};
static const unsigned char image_Layer_27_6_bits[]   = {0x8e, 0xe3, 0x00, 0x51, 0x14, 0x01, 0x41, 0x04, 0x01, 0x41, 0x84, 0x00, 0x41, 0x44, 0x00, 0x41, 0x24, 0x00, 0x51, 0x14, 0x00, 0x8e, 0xf3, 0x01};
static const unsigned char image_Layer_27_7_bits[]   = {0x11, 0x00, 0x10, 0x10, 0x41, 0x00, 0x11, 0x00, 0x00, 0x10, 0x40, 0x00, 0x11, 0x00, 0x00, 0x10, 0x40, 0x00, 0x5f, 0xf4, 0x18, 0x9e, 0xe1, 0x44, 0x51, 0x54, 0x11, 0x11, 0x41, 0x44,
                                                        0x51, 0x54, 0x11, 0x11, 0x41, 0x44, 0x51, 0x56, 0x11, 0x11, 0x41, 0x44, 0x91, 0x55, 0x39, 0x9e, 0x83, 0x79, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38};
static const unsigned char image_Layer_27_8_bits[]   = {0x1f, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x84, 0xf3, 0x3c,
                                                        0x4e, 0xe3, 0x39, 0x51, 0xe3, 0x00, 0x44, 0x54, 0x45, 0xd1, 0x14, 0x11, 0xd1, 0x14, 0x01, 0xc4, 0x57, 0x45, 0x5f, 0x10, 0x11, 0x51, 0xf0, 0x01, 0x44, 0x50, 0x45, 0x41, 0x90, 0x11,
                                                        0x59, 0x10, 0x00, 0x84, 0x57, 0x3d, 0x5e, 0x60, 0x61, 0x56, 0xe0, 0x01, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};
static const unsigned char image_Layer_27_9_bits[]   = {0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01};
static const unsigned char image_Layer_27_bits[]     = {0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
                                                        0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
                                                        0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
                                                        0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01};
static const unsigned char image_Layer_29_1_bits[]   = {0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
                                                        0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01};
static const unsigned char image_Layer_29_bits[]     = {0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
                                                        0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,
                                                        0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01};
static const unsigned char image_presenceIcon_bits[] = {0x00, 0xf0, 0x00, 0x00, 0x00, 0xf0, 0x00, 0x00, 0x00, 0xf0, 0x00, 0x00, 0x00, 0xf0, 0x00, 0x00, 0x00, 0xff, 0x0f, 0x00, 0x00, 0xff, 0x0f, 0x00, 0x00, 0xff, 0x0f, 0x00, 0x00, 0xff, 0x0f, 0x00,
                                                        0x00, 0xff, 0x0f, 0x00, 0x00, 0xff, 0x0f, 0x00, 0x00, 0xff, 0x0f, 0x00, 0x00, 0xff, 0x0f, 0x00, 0x00, 0xf0, 0x00, 0x00, 0x00, 0xf0, 0x00, 0x00, 0x00, 0xf0, 0x00, 0x00, 0x00, 0xf0, 0x00, 0x00,
                                                        0xf0, 0x0f, 0xff, 0x00, 0xf0, 0x0f, 0xff, 0x00, 0xf0, 0x0f, 0xff, 0x00, 0xf0, 0x0f, 0xff, 0x00, 0xff, 0xff, 0xff, 0x0f, 0xff, 0xff, 0xff, 0x0f, 0xff, 0xff, 0xff, 0x0f, 0xff, 0xff, 0xff, 0x0f,
                                                        0xff, 0x0f, 0xff, 0x0f, 0xff, 0x0f, 0xff, 0x0f, 0xff, 0x0f, 0xff, 0x0f, 0xff, 0x0f, 0xff, 0x0f, 0xff, 0xff, 0xff, 0x0f, 0xff, 0xff, 0xff, 0x0f, 0xff, 0xff, 0xff, 0x0f, 0xff, 0xff, 0xff, 0x0f,
                                                        0xff, 0x0f, 0xff, 0x0f, 0xff, 0x0f, 0xff, 0x0f, 0xff, 0x0f, 0xff, 0x0f, 0xff, 0x0f, 0xff, 0x0f, 0xff, 0xff, 0xff, 0x0f, 0xff, 0xff, 0xff, 0x0f, 0xff, 0xff, 0xff, 0x0f, 0xff, 0xff, 0xff, 0x0f,
                                                        0xf0, 0xff, 0xff, 0x00, 0xf0, 0xff, 0xff, 0x00, 0xf0, 0xff, 0xff, 0x00, 0xf0, 0xff, 0xff, 0x00, 0xf0, 0x0f, 0xff, 0x00, 0xf0, 0x0f, 0xff, 0x00, 0xf0, 0x0f, 0xff, 0x00, 0xf0, 0x0f, 0xff, 0x00,
                                                        0xf0, 0x0f, 0xff, 0x00, 0xf0, 0x0f, 0xff, 0x00, 0xf0, 0x0f, 0xff, 0x00, 0xf0, 0x0f, 0xff, 0x00, 0x00, 0x0f, 0x0f, 0x00, 0x00, 0x0f, 0x0f, 0x00, 0x00, 0x0f, 0x0f, 0x00, 0x00, 0x0f, 0x0f, 0x00,
                                                        0x00, 0x0f, 0x0f, 0x00, 0x00, 0x0f, 0x0f, 0x00, 0x00, 0x0f, 0x0f, 0x00, 0x00, 0x0f, 0x0f, 0x00, 0xf0, 0x0f, 0xff, 0x00, 0xf0, 0x0f, 0xff, 0x00, 0xf0, 0x0f, 0xff, 0x00, 0xf0, 0x0f, 0xff, 0x00};
static const unsigned char image_tempIcon_bits[]     = {0x38, 0x00, 0x44, 0x40, 0xd4, 0xa0, 0x54, 0x40, 0xd4, 0x1c, 0x54, 0x06, 0xd4, 0x02, 0x54, 0x02, 0x54, 0x06, 0x92, 0x1c, 0x39, 0x01, 0x75, 0x01, 0x7d, 0x01, 0x39, 0x01, 0x82, 0x00, 0x7c, 0x00};

static const unsigned char image_wifi_bits[]        = {0x80, 0x0f, 0x00, 0x60, 0x30, 0x00, 0x18, 0xc0, 0x00, 0x84, 0x0f, 0x01, 0x62, 0x30, 0x02, 0x11, 0x40, 0x04, 0x08, 0x87, 0x00, 0xc4, 0x18, 0x01,
                                                       0x20, 0x20, 0x00, 0x10, 0x42, 0x00, 0x80, 0x0d, 0x00, 0x40, 0x10, 0x00, 0x00, 0x02, 0x00, 0x00, 0x05, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00};
static const unsigned char image_wifi_2_bars_bits[] = {0x80, 0x0f, 0x00, 0x60, 0x30, 0x00, 0x18, 0xc0, 0x00, 0x84, 0x0f, 0x01, 0x62, 0x30, 0x02, 0x11, 0x40, 0x04, 0x08, 0x87, 0x00, 0xc4, 0x18, 0x01,
                                                       0x20, 0x20, 0x00, 0x10, 0x42, 0x00, 0x80, 0x0f, 0x00, 0xc0, 0x1d, 0x00, 0x80, 0x0a, 0x00, 0x00, 0x07, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00};
static const unsigned char image_wifi_25_bits[]     = {0x80, 0x0f, 0x00, 0x60, 0x30, 0x00, 0x18, 0xc0, 0x00, 0x84, 0x0f, 0x01, 0x62, 0x30, 0x02, 0x11, 0x40, 0x04, 0x0a, 0x87, 0x02, 0xc4, 0x18, 0x01,
                                                       0x28, 0xa0, 0x00, 0x10, 0x47, 0x00, 0xa0, 0x2f, 0x00, 0xc0, 0x1d, 0x00, 0x80, 0x0a, 0x00, 0x00, 0x07, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00};
static const unsigned char image_wifi_3_bars_bits[] = {0x80, 0x0f, 0x00, 0x60, 0x30, 0x00, 0x18, 0xc0, 0x00, 0x84, 0x0f, 0x01, 0x62, 0x30, 0x02, 0x11, 0x40, 0x04, 0x08, 0x87, 0x00, 0xc4, 0x1f, 0x01,
                                                       0xe0, 0x38, 0x00, 0x30, 0x62, 0x00, 0xa0, 0x2f, 0x00, 0xc0, 0x1d, 0x00, 0x80, 0x0a, 0x00, 0x00, 0x07, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00};
static const unsigned char image_wifi_4_bars_bits[] = {0x80, 0x0f, 0x00, 0x60, 0x30, 0x00, 0x18, 0xc0, 0x00, 0x84, 0x0f, 0x01, 0xe2, 0x3d, 0x02, 0x71, 0x70, 0x04, 0x18, 0xc7, 0x00, 0xcc, 0x9f, 0x01,
                                                       0xe8, 0xb8, 0x00, 0x30, 0x62, 0x00, 0xa0, 0x2f, 0x00, 0xc0, 0x1d, 0x00, 0x80, 0x0a, 0x00, 0x00, 0x07, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00};
static const unsigned char image_wifi_5_bars_bits[] = {0x80, 0x0f, 0x00, 0xe0, 0x3d, 0x00, 0x78, 0xf0, 0x00, 0x8c, 0x8f, 0x01, 0xee, 0xbd, 0x03, 0x73, 0x70, 0x06, 0x1a, 0xc7, 0x02, 0xcc, 0x9f, 0x01,
                                                       0xe8, 0xb8, 0x00, 0x30, 0x62, 0x00, 0xa0, 0x2f, 0x00, 0xc0, 0x1d, 0x00, 0x80, 0x0a, 0x00, 0x00, 0x07, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x00};

#define DISPLAY_SDA 7
#define DISPLAY_SCL 6

U8G2_SH1107_PIMORONI_128X128_1_HW_I2C gDisplay(U8G2_R1, U8X8_PIN_NONE, DISPLAY_SCL, DISPLAY_SDA);

namespace ncore
{
    namespace napp
    {
        void presetup()
        {
            // Initialize I2C bus
            nwire::begin(DISPLAY_SDA, DISPLAY_SCL);

            gDisplay.begin();
        }

        void setup(state_t *state) {}

        static char *co2_text         = "1200";
        static char *IPAddress_text   = "192.168.888.888";
        static char *LightValue_text  = "7200";
        static char *macAddress_text  = "AB:2B:2F:E5:C8:94";
        static char *temperature_text = "+27.0";

        s32  wifiSignalStrength = 75;  // Example signal strength
        s8   humidity_value     = 42;  // Example humidity value
        void tick(state_t *state)
        {
            wifiSignalStrength = humidity_value;

            const unsigned char *wifiImage = image_wifi_bits;
            if (wifiSignalStrength < 25)
                wifiImage = image_wifi_2_bars_bits;
            else if (wifiSignalStrength < 35)
                wifiImage = image_wifi_25_bits;
            else if (wifiSignalStrength < 50)
                wifiImage = image_wifi_3_bars_bits;
            else if (wifiSignalStrength < 80)
                wifiImage = image_wifi_4_bars_bits;
            else
                wifiImage = image_wifi_5_bars_bits;

            humidity_value += 1;
            if (humidity_value > 99)
                humidity_value = 10;
            char humidity_text[3];
            humidity_text[0] = (humidity_value / 10) + '0';
            humidity_text[1] = (humidity_value % 10) + '0';
            humidity_text[2] = '\0';
            nserial::println(humidity_text);

            gDisplay.setFontMode(1);
            gDisplay.setBitmapMode(1);
            gDisplay.setPowerSave(0);

            gDisplay.firstPage();
            do
            {
                gDisplay.setFont(u8g2_font_profont22_tr);
                gDisplay.drawStr(10, 51, co2_text);

                gDisplay.drawStr(63, 18, LightValue_text);
                gDisplay.drawStr(76, 52, humidity_text);
                gDisplay.drawStr(45, 90, temperature_text);

                gDisplay.drawXBM(4, 3, 19, 16, wifiImage);

                gDisplay.drawXBM(110, 77, 16, 16, image_tempIcon_bits);
                gDisplay.drawXBM(7, 60, 28, 64, image_presenceIcon_bits);
                gDisplay.drawXBM(111, 37, 11, 16, image_humidityIcon_bits);

                gDisplay.setFont(u8g2_font_5x8_tr);
                gDisplay.drawStr(43, 124, macAddress_text);
                gDisplay.drawStr(47, 111, IPAddress_text);

                gDisplay.drawXBM(0, 21, 128, 1, image_Layer_26_bits);
                gDisplay.drawXBM(127, 0, 1, 128, image_Layer_27_bits);
                gDisplay.drawXBM(0, 57, 128, 1, image_Layer_26_bits);
                gDisplay.drawXBM(31, 10, 29, 10, image_Layer_27_1_bits);
                gDisplay.drawXBM(0, 0, 128, 1, image_Layer_26_bits);
                gDisplay.drawXBM(0, 1, 1, 127, image_Layer_27_2_bits);
                gDisplay.drawXBM(41, 96, 87, 1, image_Layer_27_3_bits);
                gDisplay.drawXBM(0, 127, 128, 1, image_Layer_26_bits);
                gDisplay.drawXBM(49, 26, 15, 5, image_Layer_27_4_bits);
                gDisplay.drawXBM(113, 13, 13, 6, image_Layer_27_5_bits);
                gDisplay.drawXBM(9, 24, 17, 8, image_Layer_27_6_bits);
                gDisplay.drawXBM(75, 24, 47, 10, image_Layer_27_7_bits);
                gDisplay.drawXBM(45, 61, 65, 10, image_Layer_27_8_bits);
                gDisplay.drawXBM(27, 0, 1, 22, image_Layer_27_9_bits);
                gDisplay.drawXBM(41, 58, 1, 70, image_Layer_29_bits);
                gDisplay.drawXBM(70, 21, 1, 37, image_Layer_29_1_bits);

                gDisplay.sendBuffer();
            } while (gDisplay.nextPage());
            delay(500);
        }

    }  // namespace napp
}  // namespace ncore